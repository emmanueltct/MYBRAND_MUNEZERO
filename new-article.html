<html>
    <head>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'>
        <title> My Brand page</title>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="./richtexteditor/rte_theme_default.css" />
		<script type="text/javascript" src="./richtexteditor/rte.js"></script>
		<script type="text/javascript" src='./richtexteditor/plugins/all_plugins.js'></script>

        <link rel="stylesheet" href="css/admin-panel.css"/>
        <style>
        .blog-form-container{
            width:100%;
            margin:auto;
            display:flex;
            flex-direction: column;
            align-items:center;
            padding:5% 0%;
            gap:15px;
        }
        .page-title{
            color: #333;
            margin:2%;
            text-align: center;
            font-family: "Work Sans";
            font-size: 32px;
            font-style: normal;
            font-weight: 700;
            line-height: 44px; 
        }
        .article-form{
            display: flex;
            width:100%;
            padding: 27px 30px;
            flex-direction: column;
            align-items:center;
            justify-content: center;
            gap: 33px;
            flex-shrink: 0;
            align-self: stretch;
            border-radius: 20px;
            background: #FFF;
            box-shadow: 0px 4px 10px 0px rgba(0, 0, 0, 0.25);
        }
        .form-container{
            display: flex;
            width:80%;
            justify-content: center;
            align-items: center;
        }
        .input-section{
            width:100%;
            display:flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 5px; 
            overflow: auto;
        }
        .input-section label{
            color: #000;
            font-family: "Work Sans";
            font-size: 16px;
            font-style: normal;
            font-weight: 400;
            line-height: 20px; /* 150% */
        }
        .input-section input{
            height:40px;
            width:100%;
            border-radius: 10px;
            border: 1px solid #000; 
        }
        .submit-button{
                display: flex;
                width: 200px;
                height:45px;
                padding: 12px 24px;
                justify-content: center;
                align-items: center;
                gap: 12px;
                border-radius: 10px;
                font-size:18px;
                border:none;
                color:#fff;
                background-color: #A53DFF;
        }
        
        small{
            color:rgb(240, 37, 148) ;
            font-size: medium;
           
        }
        .old-thumbnail{
            display:flex;
            flex-direction: column;
            display:none;
            width:15%;
            cursor: pointer;
        }
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #462dc2;
            border-bottom-color: #FF3D00;
            border-radius: 50%;
            display: none;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
            }

            @keyframes rotation {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
            } 
        
    </style>
    </head>
    <body>
    <div class="container">
        <div class="left-side" id="left-side">
            <div class="user-profile">
                <div class="profile-image"><div>E</div></div>
                <div class="user-profile-text">Emmanuel</div>
            </div>
            <div class="left-side-menu">
                <div class="menu">
                    <div class="menu-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="15" viewBox="0 0 35 31" fill="none">
                            <path d="M32.0833 0.1875H2.91667C1.30642 0.1875 0 1.65723 0 3.46875V27.5312C0 29.3428 1.30642 30.8125 2.91667 30.8125H32.0833C33.6936 30.8125 35 29.3428 35 27.5312V3.46875C35 1.65723 33.6936 0.1875 32.0833 0.1875ZM10.6944 6.74999C12.8394 6.74999 14.5833 8.71191 14.5833 11.125C14.5833 13.5381 12.8394 15.5 10.6944 15.5C8.54948 15.5 6.80556 13.5381 6.80556 11.125C6.80556 8.71191 8.54948 6.74999 10.6944 6.74999ZM17.5 22.9375C17.5 23.6621 16.8924 24.25 16.1389 24.25H5.25C4.49653 24.25 3.88889 23.6621 3.88889 22.9375V21.625C3.88889 19.4512 5.71788 17.6875 7.97222 17.6875H8.27604C9.02344 18.0361 9.83767 18.2344 10.6944 18.2344C11.5512 18.2344 12.3715 18.0361 13.1128 17.6875H13.4167C15.671 17.6875 17.5 19.4512 17.5 21.625V22.9375ZM31.1111 19.3281C31.1111 19.6289 30.8924 19.875 30.625 19.875H21.875C21.6076 19.875 21.3889 19.6289 21.3889 19.3281V18.2344C21.3889 17.9336 21.6076 17.6875 21.875 17.6875H30.625C30.8924 17.6875 31.1111 17.9336 31.1111 18.2344V19.3281ZM31.1111 14.9531C31.1111 15.2539 30.8924 15.5 30.625 15.5H21.875C21.6076 15.5 21.3889 15.2539 21.3889 14.9531V13.8594C21.3889 13.5586 21.6076 13.3125 21.875 13.3125H30.625C30.8924 13.3125 31.1111 13.5586 31.1111 13.8594V14.9531ZM31.1111 10.5781C31.1111 10.8789 30.8924 11.125 30.625 11.125H21.875C21.6076 11.125 21.3889 10.8789 21.3889 10.5781V9.48437C21.3889 9.18359 21.6076 8.93749 21.875 8.93749H30.625C30.8924 8.93749 31.1111 9.18359 31.1111 9.48437V10.5781Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="menu-text">
                        <a href="admin-index.html">Dashboard</a>
                    </div>
                </div>
            </div>
            <div class="left-side-menu">
                <div class="menu">
                    <div class="menu-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="15" viewBox="0 0 35 31" fill="none">
                            <path d="M10.2083 12.7656V18.2344C10.2083 19.1405 9.47379 19.875 8.56769 19.875H1.64062C0.734521 19.875 0 19.1405 0 18.2344V12.7656C0 11.8595 0.734521 11.125 1.64062 11.125H8.56769C9.47379 11.125 10.2083 11.8595 10.2083 12.7656ZM0 23.7031V29.1719C0 30.078 0.734521 30.8125 1.64062 30.8125H8.56769C9.47379 30.8125 10.2083 30.078 10.2083 29.1719V23.7031C10.2083 22.797 9.47379 22.0625 8.56769 22.0625H1.64062C0.734521 22.0625 0 22.797 0 23.7031ZM8.56769 0.1875H1.64062C0.734521 0.1875 0 0.922021 0 1.82812V7.29687C0 8.20297 0.734521 8.93749 1.64062 8.93749H8.56769C9.47379 8.93749 10.2083 8.20297 10.2083 7.29687V1.82812C10.2083 0.922021 9.47379 0.1875 8.56769 0.1875ZM14.0364 30.8125H33.3594C34.2655 30.8125 35 30.078 35 29.1719V23.7031C35 22.797 34.2655 22.0625 33.3594 22.0625H14.0364C13.1303 22.0625 12.3958 22.797 12.3958 23.7031V29.1719C12.3958 30.078 13.1303 30.8125 14.0364 30.8125ZM12.3958 1.82812V7.29687C12.3958 8.20297 13.1303 8.93749 14.0364 8.93749H33.3594C34.2655 8.93749 35 8.20297 35 7.29687V1.82812C35 0.922021 34.2655 0.1875 33.3594 0.1875H14.0364C13.1303 0.1875 12.3958 0.922021 12.3958 1.82812ZM14.0364 19.875H33.3594C34.2655 19.875 35 19.1405 35 18.2344V12.7656C35 11.8595 34.2655 11.125 33.3594 11.125H14.0364C13.1303 11.125 12.3958 11.8595 12.3958 12.7656V18.2344C12.3958 19.1405 13.1303 19.875 14.0364 19.875Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="menu-text">
                        Articles 
                    </div>
                    <span ><i class="fa fa-caret-down" aria-hidden="true" style="font-size:30px;"></i></span>
                </div>
                <ul class="dropdown-menu">
                    <li><a href="new-article.html"><span><i class="fa fa-plus" aria-hidden="true"></i></span> <span>Add Article</span></a></li>
                    <li><a href="admin-blog-list.html"><span><i class="fa fa-eye" aria-hidden="true"></i></span> <span>view Articles</span></a></li>
                </ul>
            </div>

            <div class="left-side-menu">
                <div class="menu">
                    <div class="menu-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="15" viewBox="0 0 35 31" fill="none">
                            <path d="M34.3369 10.3001C34.6035 10.0529 35 10.2842 35 10.675V26.9844C35 29.0978 33.5303 30.8125 31.7188 30.8125H3.28125C1.46973 30.8125 0 29.0978 0 26.9844V10.6829C0 10.2842 0.389648 10.0609 0.663086 10.3081C2.19434 11.6958 4.22461 13.4583 11.1973 19.368C12.6396 20.5962 15.0732 23.1802 17.5 23.1642C19.9404 23.1881 22.4219 20.5483 23.8096 19.368C30.7822 13.4583 32.8057 11.6878 34.3369 10.3001ZM17.5 20.6042C19.0859 20.6361 21.3691 18.2754 22.5176 17.3024C31.5889 9.62223 32.2793 8.9523 34.3711 7.03824C34.7676 6.67936 35 6.12109 35 5.53092V4.01562C35 1.90218 33.5303 0.1875 31.7188 0.1875H3.28125C1.46973 0.1875 0 1.90218 0 4.01562V5.53092C0 6.12109 0.232422 6.67138 0.628906 7.03824C2.7207 8.94433 3.41113 9.62223 12.4824 17.3024C13.6309 18.2754 15.9141 20.6361 17.5 20.6042Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="menu-text">
                      <a href="admin-queries.html"> Queries</a>
                    </div>
                </div>
            </div>

            <div class="left-side-menu">
                <div class="menu">
                    <div class="menu-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="19" height="15" viewBox="0 0 35 31" fill="none">
                            <path d="M34.7082 6.71315C34.5551 6.17303 33.7826 5.99 33.3328 6.38357L28.2496 10.8314L23.6094 10.1549L22.8362 6.09467L27.9194 1.64688C28.372 1.25091 28.1539 0.576204 27.5325 0.441024C24.2937 -0.261196 20.7274 0.495455 18.196 2.70978C15.4863 5.08082 14.7405 8.51775 15.8684 11.5144L1.28122 24.2782C-0.427074 25.773 -0.427074 28.1966 1.28122 29.6914C2.98952 31.1862 5.75943 31.1862 7.46773 29.6914L22.0426 16.9384C25.4688 17.9379 29.3892 17.2781 32.1167 14.8916C34.6508 12.6742 35.5141 9.54895 34.7082 6.71315ZM4.37516 28.4198C3.4694 28.4198 2.73454 27.7768 2.73454 26.9842C2.73454 26.1911 3.4694 25.5487 4.37516 25.5487C5.28092 25.5487 6.01578 26.1911 6.01578 26.9842C6.01578 27.7768 5.28092 28.4198 4.37516 28.4198Z" fill="black"/>
                        </svg>
                    </div>
                    <div class="menu-text">
                        Setting
                    </div>
                </div>
            </div>
        </div>
        <div id="snackbar"></div>
        <div class="right-side" id="right-side" >
            <div class="user-info">
                
                <div class="user-info-box1">
                    <button id="show-menu" onclick="showMenu()"><img src="img/menu.svg" width="18px"></button> 
                    <button id="close-menu"  onclick="closeMenu()"><i class="fa fa-close" style="font-size:30px;color:#A53DFF"></i></button>
                    <div class="user">Munezero Emmanuel</div>
                    <a href="#"><button onclick="userLogout()" class="logout">logout</button></a>
                </div>
            </div>
            <div class="blog-form-container">
               <div class="page-title">
                <h3>post new article / blog here</h3>
               </div>
               <div class="form-error"></div>
               <div class="form-container">
                <form class="article-form" id="article-form" method="post">
                    <div class="input-section">
                        <label>Blog Title:</label>
                        <input class="input" id="article-title" name="article-title" type="" value=""/>
                        <small id="article-error"></small>
                    </div>
                    <div class="input-section">
                        <label>Blog intro:</label>
                        <textarea class="input" style="width:100%;box-sizing: border-box;border-radius:10px;" id="intro"  cols="5" rows="6" onchange="validateBlogIntro()"></textarea>
                        <small id="intro-error"></small>
                    </div>
                   <div class="input-section">
                        <label id="blog-thumbnail-label">Select Blog Thumbnail:</label>
                        <input id="thumbnail" name="image" type="file" value="" onchange="validateImage()"/>
                        <small id="thumbnail-error"></small>
                        
                        <div class="old-thumbnail">
                            <img class="existing-profile" style="width:100px;">
                            <br/>
                            <span style="background-color: rgb(41, 44, 44); padding:2%;border-radius:5px; color: #FFF; text-align:center;" onclick="changeThumbnail()"> change it here</span>
                        </div>
                    </div>
                    <div class="input-section">
                        <label  id="articleError">Elaborate more on your topic:</label>
                        <textarea class="input" id="inp_editor1" name="description" onchange="validateRichText()" >
                        </textarea>
                    </div>
                    <div class="input-section">
                        <span class="loader"></span>
                        <button class="submit-button" id="newArticle">
                            <span>Post Article</span>
                            <img src="img/Paper Plane.png" style="width:24px;height:24px;"/>
                        </button>

                        <button class="submit-button" id="updateArticle">
                            <span>Update Article</span>
                        </button>
                        
                    </div>
                </form>
            </div>
        </div>
        </div>
        </div> 
    </div>
      
    <div class="footer-section">
        Copyright © 2022 Emmanuel
    </div>  
    </body>
</html>

<script src="js/admin-menu.js"></script>
<script src="js/toastmessage.js"></script>
<script src="js/authchecks.js"></script>
<script src="js/create-blog-api.js"></script>
<script>
    
    var editor1 = new RichTextEditor("#inp_editor1");
    /// var editor1 = new RichTextEditor("#div_editor1", { editorResizeMode:"both"  });
    const input=document.querySelectorAll(".input");
    const form=document.getElementById('article-form')
    const title=document.getElementById("article-title");
    const thumbnail=document.getElementById('thumbnail');
    const blogIntro=document.getElementById('intro');
    const buttons=document.querySelectorAll('.submit-button');
    const updatearticle=document.getElementById('updateArticle');
    const newArticle=document.getElementById('newArticle');

    updatearticle.style.display='none';

    let date = new Date();
    let article='';
    let desc='';
    let img='';
    let clickedButtton='';


    buttons.forEach(btn=>{
        btn.addEventListener('click',()=>{
            clickedButtton=btn.id;
            
        })
    })
    


    form.addEventListener('submit',(e)=>{
        e.preventDefault();
        //handleInputs();

        if(handleInputs() && validateImage() && validateRichText()){
           
            article =document.getElementById("article-title").value;
            image=document.getElementById('thumbnail').files[0]
            desc=document.getElementById('inp_editor1').value;
            let intro=document.getElementById("intro").value;
           
            if(clickedButtton=="newArticle"){
                formData=new FormData()
                formData.append('title',article)
                formData.append('image',image)
                formData.append('blogIntro',intro)
                formData.append('content',desc)
                createBlog(formData)  
            }

            if(clickedButtton=="updateArticle"){

               const formData=new FormData()
                if(!image){
                    formData.append('title',article)
                    formData.append('blogIntro',intro)
                    formData.append('content',desc)   
                    /// window.location.href='admin-blog-list.html';
                }
             else{
                    formData.append('title',article)
                    formData.append('image',image)
                    formData.append('blogIntro',intro)
                    formData.append('content',desc)   
                    // window.location.href='admin-blog-list.html'; 

              }
            
              updateBlog(formData)

                }      
                 
            }
       
    })

    getSingleBlog()


function updateArticleFun(date,article,image,desc){
   
     /*  
    blogData[blogText].date=date;
    blogData[blogText].title=article;
    blogData[blogText].img=img;
    blogData[blogText].desc=desc;
    localStorage.setItem("formValue", JSON.stringify(blogData));
    alert ('data updated');
    window.location.href='admin-blog-list.html';
    */
}


 

        // article title validation -----------------------------------------

        input.forEach(inputElement=>{
            inputElement.addEventListener('keyup',()=>{
               // console.log(inputElement)
                handleInputs();
            })
        })
 


    function handleInputs(){
        
        const titleValue=title.value.trim();
        

        if(titleValue ===''){
            title.style.border='1px solid red';
            document.getElementById("article-error").innerText='Article title is required';
            return false;
        }else if(titleValue.length<20){
            document.getElementById("article-error").innerText='Article title should be atleast more than 20 characters'; 
            return false;
        }
        else if(titleValue.length>100){
            document.getElementById("article-error").innerText='Article title should be not greater than 100 characters'; 
            return false;
        }
        else{
            title.style.border='1px solid #A53DFF';
            document.getElementById("article-error").innerText='';  
            validateBlogIntro() ;
            return true;
            
        }

    }
        // thumbnail validation ----------------------------------------
    
    function validateBlogIntro(){
        const blogIntroValue=blogIntro.value.trim();
        if(blogIntroValue ===''){
            blogIntro.style.border='1px solid red';
            document.getElementById("intro-error").innerText='blog introduction is required';
            return false;
        }else if(blogIntroValue.length<50){
            document.getElementById("intro-error").innerText='blog introduction should be atleast more than 50 characters'; 
            return false;
        }
        else if(blogIntroValue.length>200){
            document.getElementById("intro-error").innerText='blog introduction should be not greater than 200 characters'; 
            return false;
        }
        else{
            blogIntro.style.border='1px solid #A53DFF';
            document.getElementById("intro-error").innerText='';  
            validateImage();
            return true;
            
        }
    }
    function validateImage(){
        if(clickedButtton=="updateArticle" && thumbnail.value ==''){
               return true;
            }else{
                if(thumbnail.value !==""){
                let selectedFile=thumbnail.files[0];
                let  allowedTypes = ['image/jpeg', 'image/png', 'img/jpg','image/webp'];
                
                 if (!allowedTypes.includes(selectedFile.type)) {
                    thumbnail.style.border='1px solid red';
                    thumbnail.value = '';
                    document.getElementById('thumbnail-error').innerText='Invalid file type. Please upload a JPEG, JPG, PNG, or WEBP';
                    return false;
                }else if(Math.round(selectedFile.size/1024)>2048){
                    thumbnail.style.border='1px solid red';
                    thumbnail.value = '';
                    document.getElementById('thumbnail-error').innerText='File size should not be greater than 2MB';
                    return false;
                }else{
                    thumbnail.style.border='1px solid #A53DFF'; 
                    document.getElementById('thumbnail-error').innerText='';
                    validateRichText();
                }
              }
            }

       // console.log('its working');
       const searchParams2 = new URLSearchParams(window.location.search);
       const blogText=searchParams2.get('updateBlog');
            console.log('blog',blogText)
       if(!blogText){

        let selectedFile=thumbnail.files[0];
        let  allowedTypes = ['image/jpeg', 'image/png', 'img/jpg','image/webp'];

        if(thumbnail.value==''){
            thumbnail.style.border='1px solid red';
            document.getElementById('thumbnail-error').innerText='Article thumbnail is required please select image';
        }else if (!allowedTypes.includes(selectedFile.type)) {
            thumbnail.style.border='1px solid red';
            thumbnail.value = '';
            document.getElementById('thumbnail-error').innerText='Invalid file type. Please upload a JPEG, JPG, PNG, or WEBP';
            return false;
         }else if(Math.round(selectedFile.size/1024)>2048){
            thumbnail.style.border='1px solid red';
            thumbnail.value = '';
            document.getElementById('thumbnail-error').innerText='File size should not be greater than 2MB';
            return false;
         }else{
            thumbnail.style.border='1px solid #A53DFF'; 
            document.getElementById('thumbnail-error').innerText='';
            validateRichText();
         }

        }
       return true;
    }
    

    
        // article rich textor valididation -----------------------------------------

        //const articleText2=document.getElementById("inp_editor1"); 

        editor1.attachEvent("change", function () {
            var textCount = editor1.getPlainText().trim().length;
            validateRichText() 
        });

    function validateRichText(textCount){
        //console.log('its work')
        const articleText=editor1.getPlainText().trim();
        var articleError=document.getElementById("articleError");
        //console.log(articleText)
          if(articleText.length<=100){
        
             articleError.style.color='rgb(240, 37, 148)';
             articleError.innerText='The article text should be atleast 100 charcters or more';
             return false;
          }else{
             //console.log(articleText.value);
             articleError.innerText='Elaborate more on your topic:';
             articleError.style.color='#000';
            
          }
          return true;
     }
 
function changeThumbnail(){
    console.log('i want to change it');
    document.querySelector('.old-thumbnail').style.display='none';
    document.getElementById('blog-thumbnail-label').innerText='Select Blog Thumbnail:'
    thumbnail.style.display='block';
}

</script>


